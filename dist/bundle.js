(()=>{"use strict";var e={307:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BoardLogic=void 0;var n=o(434),i=function(){function e(){}return e.initBoard=function(t){for(var o=0;o<e.columns;o++){t[o]=new Array(e.rows);for(var i=0;i<e.rows;i++)t[o][i]=n.Dot.Empty}},e.checkDotCount=function(t,o,n,i){for(var a=n,r=0;r<4&&a<e.rows&&t[o][a]===i;)r++,a++;if(r<4){for(r=0,a=o;a<e.columns&&t[a][n]===i;)r++,a++;for(a=o-1;a>-1&&t[a][n]===i;)r++,a--;if(r<4){r=0;for(var s=n-1,l=o+1;r<4&&s>-1&&l<e.columns&&t[l][s]===i;)r++,l++,s--;for(l=o,s=n;r<4&&s<e.rows&&l>-1&&t[l][s]===i;)r++,l--,s++;if(r<4){for(r=0,s=n-1,l=o-1;r<4&&s>-1&&l>-1&&t[l][s]===i;)r++,l--,s--;for(l=o,s=n;r<4&&s<e.rows&&l<e.columns&&t[l][s]===i;)r++,l++,s++}}}return r},e.isBoardFull=function(t){for(var o=!0,i=0;i<e.columns;i++)if(t[i][0]===n.Dot.Empty){o=!1;break}return o},e.columns=9,e.rows=8,e}();t.BoardLogic=i},434:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Dot=void 0,(o=t.Dot||(t.Dot={})).Empty="black",o.Red="red",o.Green="greenyellow"},607:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.GameMode=void 0,(o=t.GameMode||(t.GameMode={}))[o.SamePC=1]="SamePC",o[o.Network=2]="Network"},998:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Sound=void 0,(o=t.Sound||(t.Sound={})).LandDot="./sounds/land-dot.m4a",o.Win="./sounds/win.m4a",o.Lose="./sounds/lose.m4a"},664:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var n=o(607),i=o(434),a=o(42),r=o(721),s=o(771),l=o(998),c=o(307),d=function(){function e(e,t,o,r,s){var l=this;this.board=new Array(c.BoardLogic.columns),this.turn=i.Dot.Red,this.canvasMousemove=function(e){if(l.mode===n.GameMode.SamePC||l.socket&&l.turn===l.socket.getPlayerColor()&&l.opponentConnected()){var t=a.Position.getCursorPosition(e,l.canvas),o=Math.round((t.x-50)/l.colGap);if(l.moveDot(o),l.mode===n.GameMode.Network&&l.socket){var i={action:"mousemove",column:o};l.socket.send(i)}}},this.canvasClick=function(e){if(l.mode===n.GameMode.SamePC||l.socket&&l.turn===l.socket.getPlayerColor()&&l.opponentConnected()){var t=a.Position.getCursorPosition(e,l.canvas),o=Math.round((t.x-50)/l.colGap);if(l.mode===n.GameMode.Network&&l.socket){var i={action:"click",column:o};l.socket.send(i)}l.landDot(o)}},this.beforeUnload=function(e){l.mode===n.GameMode.SamePC?l.saveGame():l.mode===n.GameMode.Network&&(e.preventDefault(),e.returnValue="")},this.timerCallback=function(){if(l.mode!==n.GameMode.Network||l.opponentConnected()){l.secondsRunning++;var e=Math.floor(l.secondsRunning/60),t=l.secondsRunning%60;l.timerSpan.innerText=e+":"+(t<10?"0":"")+t}l.timerSpan.classList.contains("hide")?clearTimeout(l.timeout):l.timeout=setTimeout(l.timerCallback,1e3)},this.pageVisibilityChange=function(){l.mode!==n.GameMode.Network&&(document.hidden?clearTimeout(l.timeout):l.timeout=setTimeout(l.timerCallback,1e3))},this.resizeCanvas=function(){l.canvas.height=window.innerHeight-100,l.canvas.width=window.innerWidth,l.canvas.width<1e3?l.circleRadius=20:l.circleRadius=30,l.canvas.height>l.canvas.width?(l.colGap=l.canvas.width/c.BoardLogic.columns,l.rowGap=l.canvas.height/c.BoardLogic.rows):(l.colGap=l.canvas.width/c.BoardLogic.columns,l.rowGap=65),l.paintBoard()},this.socketMessage=function(e){e.opponentName&&l.socket&&(l.socket.getPlayerColor()===i.Dot.Red?(l.playerGreen=e.opponentName,l.playerGreenSpan&&(l.playerGreenSpan.innerText=l.playerGreen)):l.socket.getPlayerColor()===i.Dot.Green&&(l.playerRed=e.opponentName,l.playerRedSpan&&(l.playerRedSpan.innerText=l.playerRed))),e.color&&l.socket&&(e.color===i.Dot.Red?(l.playerRed=l.socket.getPlayerName(),l.playerRedSpan&&(l.playerRedSpan.innerText=l.playerRed)):e.color===i.Dot.Green&&(l.playerGreen=l.socket.getPlayerName(),l.playerGreenSpan&&(l.playerGreenSpan.innerText=l.playerGreen))),e.win&&l.closeGameByWinning(),isNaN(e.column)||"mousemove"!==e.action||l.moveDot(e.column),isNaN(e.column)||"click"!==e.action||l.landDot(e.column)},this.canvas=document.getElementById(e),this.context=this.canvas.getContext("2d"),c.BoardLogic.initBoard(this.board),null!==t&&(this.exitBtn=document.getElementById(t)),null!==o&&(this.timerSpan=document.getElementById(o),this.secondsRunning=0),null!==r&&(this.playerRedSpan=document.getElementById(r)),null!==s&&(this.playerGreenSpan=document.getElementById(s))}return e.getInstance=function(t,o,n,i,a){return void 0===o&&(o=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),e.instance||(e.instance=new e(t,o,n,i,a)),e.instance},e.prototype.start=function(){this.mode===n.GameMode.SamePC?(this.checkGameData(),this.setUpPlayerNames()):this.mode===n.GameMode.Network&&this.defineSocket(),this.printPlayerNames(),this.resizeCanvas(),this.setGameEvents(),this.setTimer()},e.prototype.checkGameData=function(){var e=localStorage.getItem("board"),t=localStorage.getItem("nextTurn");e&&t&&(confirm("Do you want to continue playing the previous game? OK/Cancel")?this.restoreLastGame():localStorage.clear())},e.prototype.setUpPlayerNames=function(){localStorage.getItem("playerRed")&&localStorage.getItem("playerGreen")||(this.playerRed=prompt("Please enter name for Red Player!"),this.playerGreen=prompt("Please enter name for Green Player!"))},e.prototype.printPlayerNames=function(){var e="Waiting to connect...";this.playerGreenSpan&&(this.mode!==n.GameMode.Network||this.playerGreen?this.playerGreenSpan.innerText=this.playerGreen:this.playerGreenSpan.innerText=e),this.playerRedSpan&&(this.mode!==n.GameMode.Network||this.playerRed?this.playerRedSpan.innerText=this.playerRed:this.playerRedSpan.innerText=e)},e.prototype.paintBoard=function(){var e=this.context.createLinearGradient(0,0,this.canvas.width,0);e.addColorStop(0,"blue"),e.addColorStop(1,"aqua"),this.context.fillStyle=e,this.context.fillRect(0,70,this.canvas.width,this.canvas.height);for(var t=c.BoardLogic.columns-1;t>=0;t--)for(var o=c.BoardLogic.rows-1;o>=0;o--)this.context.fillStyle=this.board[t][o],this.context.beginPath(),this.context.arc(50+t*this.colGap,150+o*this.rowGap,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill()},e.prototype.setGameEvents=function(){this.canvas.addEventListener("mousemove",this.canvasMousemove,!1),this.canvas.addEventListener("click",this.canvasClick,!1),window.addEventListener("beforeunload",this.beforeUnload),window.addEventListener("resize",this.resizeCanvas),document.addEventListener("visibilitychange",this.pageVisibilityChange)},e.prototype.switchTurn=function(){this.turn===i.Dot.Red?this.turn=i.Dot.Green:this.turn===i.Dot.Green&&(this.turn=i.Dot.Red)},e.prototype.moveDot=function(e){this.clearUpper(),this.context.fillStyle=this.turn,this.paintDotToDrop(e)},e.prototype.landDot=function(e){var t;if(this.board[e][0]===i.Dot.Empty){for(var o=c.BoardLogic.rows-1;o>-1;o--)if(this.board[e][o]===i.Dot.Empty){this.board[e][o]=this.turn,t=o;break}if(this.context.fillStyle=this.turn,this.context.beginPath(),this.context.arc(50+e*this.colGap,150+o*this.rowGap,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill(),c.BoardLogic.checkDotCount(this.board,e,t,this.turn)>3){var n="";this.turn===i.Dot.Red?n=this.playerRed+" (Red)":this.turn===i.Dot.Green&&(n=this.playerGreen+" (Green)"),this.winDialog(n),this.closeGameByWinning()}else c.BoardLogic.isBoardFull(this.board)?(alert(this.playerRed+" (Red) and "+this.playerGreen+" (Green) are tied!"),this.closeGameByWinning()):(this.switchTurn(),this.context.fillStyle=this.turn,this.paintDotToDrop(e),r.Utils.playSound(l.Sound.LandDot))}},e.prototype.winDialog=function(e){var t=e+" wins!";this.timerSpan&&(t+="\nTime taken: "+this.timerSpan.innerText),this.mode===n.GameMode.Network?(t+="\n",this.socket.getPlayerColor()===this.turn?(t+="You win!",r.Utils.playSound(l.Sound.Win)):(t+="You lose!",r.Utils.playSound(l.Sound.Lose))):r.Utils.playSound(l.Sound.Win),alert(t)},e.prototype.closeGameByWinning=function(){this.mode===n.GameMode.SamePC&&localStorage.clear(),this.cleanUpEvents(),this.stopTimer(),this.clearPlayerNames(),this.exitBtn&&this.exitBtn.classList.add("hide"),this.resetValues(),this.onGameEnd&&setTimeout(this.onGameEnd,3e3)},e.prototype.paintDotToDrop=function(e){this.context.beginPath(),this.context.arc(50+e*this.colGap,this.circleRadius,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill()},e.prototype.clearUpper=function(){this.context.clearRect(0,0,this.canvas.width,70)},e.prototype.cleanUpEvents=function(){this.canvas.removeEventListener("mousemove",this.canvasMousemove,!1),this.canvas.removeEventListener("click",this.canvasClick,!1),window.removeEventListener("beforeunload",this.beforeUnload),window.removeEventListener("resize",this.resizeCanvas),document.removeEventListener("changevisibility",this.pageVisibilityChange)},e.prototype.saveGame=function(){localStorage.setItem("nextTurn",this.turn.toString()),localStorage.setItem("board",JSON.stringify(this.board)),localStorage.setItem("playerRed",this.playerRed),localStorage.setItem("playerGreen",this.playerGreen),localStorage.setItem("secondsRunning",this.secondsRunning.toString())},e.prototype.restoreLastGame=function(){var e=localStorage.getItem("nextTurn");e===i.Dot.Red?this.turn=i.Dot.Red:e===i.Dot.Green&&(this.turn=i.Dot.Green),this.playerRed=localStorage.getItem("playerRed"),this.playerGreen=localStorage.getItem("playerGreen"),this.board=JSON.parse(localStorage.getItem("board")),this.secondsRunning=parseInt(localStorage.getItem("secondsRunning"))},e.prototype.exit=function(){(this.mode!==n.GameMode.Network||confirm("Network game in progress. Are you sure you want to quit?"))&&(this.cleanUpEvents(),this.mode===n.GameMode.SamePC?this.saveGame():this.mode===n.GameMode.Network&&this.socket.close(),this.onGameEnd(),this.stopTimer(),this.clearPlayerNames(),this.resetValues())},e.prototype.setTimer=function(){this.timerSpan&&(this.timerSpan.classList.remove("hide"),this.timerCallback())},e.prototype.stopTimer=function(){this.timeout&&(clearTimeout(this.timeout),this.timerSpan.innerText="",this.timerSpan.classList.add("hide"))},e.prototype.clearPlayerNames=function(){this.playerGreenSpan&&(this.playerGreenSpan.innerText=""),this.playerRedSpan&&(this.playerRedSpan.innerText="")},e.prototype.defineSocket=function(){this.socket=new s.Socket,this.socket.onMessageCallback=this.socketMessage},e.prototype.opponentConnected=function(){return this.mode===n.GameMode.Network&&!!this.playerRed&&!!this.playerGreen},e.prototype.resetValues=function(){this.secondsRunning=0,this.turn=i.Dot.Red,c.BoardLogic.initBoard(this.board),this.playerRed=null,this.playerGreen=null,this.socket.close()},e}();t.Game=d},42:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Position=void 0;var o=function(){function e(e,t){this.x=e,this.y=t}return e.getCursorPosition=function(t,o){var n,i;return void 0!==t.pageX||void 0!==t.pageY?(n=t.pageX,i=t.pageY):(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),new e(n-=o.offsetLeft,i-=o.offsetTop)},e}();t.Position=o},771:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var n=o(721),i=function(){function e(){var e=this;this.onMessage=function(t){var o=JSON.parse(t.data);if(e.gameId||isNaN(o.gameId)||(e.gameId=o.gameId),!e.playerColor&&o.color){e.playerColor=o.color,e.playerName=prompt("You are "+e.playerColor+". Please enter your name.");var n={name:e.playerName};e.send(n)}e.onMessageCallback&&e.onMessageCallback(o)},this.onError=function(){alert("Problem connecting to server!")},this.onClose=function(){e.connect()},this.connect()}return e.prototype.connect=function(){var e;e=n.Utils.isLocal()?"ws://localhost:3000/":"wss://daniels-connect4-server.adaptable.app/",this.playerColor&&!isNaN(this.gameId)&&(e+="?playerColor="+this.playerColor+"&gameId="+this.gameId+"&playerName="+this.playerName),this.webSocket=new WebSocket(e),this.webSocket.onmessage=this.onMessage,this.webSocket.onerror=this.onError,this.webSocket.onclose=this.onClose},e.prototype.send=function(e){this.webSocket.send(JSON.stringify(e))},e.prototype.close=function(){this.webSocket.onclose=null,this.webSocket.onmessage=null,this.webSocket.onerror=null,this.webSocket.close()},e.prototype.getPlayerColor=function(){return this.playerColor},e.prototype.getPlayerName=function(){return this.playerName},e}();t.Socket=i},721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var o=function(){function e(){}return e.isLocal=function(){return"file:"===location.protocol||"localhost"===location.hostname},e.playSound=function(e){new Audio(e).play()},e}();t.Utils=o}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}(()=>{var e,t=o(664),n=o(607),i=document.getElementById("menu"),a=document.getElementById("samePC"),r=document.getElementById("sockets"),s=document.getElementById("credits"),l=document.getElementById("exitBtn"),c=document.getElementById("board");function d(o){(e=t.Game.getInstance("board","exitBtn","timer","playerRed","playerGreen")).mode=o,e.onGameEnd=function(){i.classList.remove("hide"),c.classList.add("hide"),l.classList.add("hide")},e.start(),i.classList.add("hide"),c.classList.remove("hide"),l.classList.remove("hide")}a.addEventListener("click",(function(){d(n.GameMode.SamePC)}),!1),r.addEventListener("click",(function(){d(n.GameMode.Network)}),!1),s.addEventListener("click",(function(){open("contributors.html")}),!1),l.addEventListener("click",(function(){e.exit()}),!1)})()})();
//# sourceMappingURL=bundle.js.map