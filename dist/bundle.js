(()=>{"use strict";var e={434:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Dot=void 0,(o=t.Dot||(t.Dot={})).Empty="black",o.Red="red",o.Green="greenyellow"},607:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.GameMode=void 0,(o=t.GameMode||(t.GameMode={}))[o.SamePC=1]="SamePC",o[o.Network=2]="Network"},664:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var n=o(607),i=o(434),r=o(42),a=o(721),s=function(){function e(t,o,r,s,l){var c=this;this.board=new Array(e.columns),this.turn=i.Dot.Red,this.timeouts=[],this.canvasMousemove=function(e){if(c.mode===n.GameMode.SamePC||c.turn===c.playerColor&&c.opponentConnected()){var t=c.getCursorPosition(e),o=Math.round((t.x-50)/c.colGap);if(c.moveDot(o),c.mode===n.GameMode.Network&&c.socket){var i={action:"mousemove",column:o};c.socket.send(JSON.stringify(i))}}},this.canvasClick=function(e){if(c.mode===n.GameMode.SamePC||c.turn===c.playerColor&&c.opponentConnected()){var t=c.getCursorPosition(e),o=Math.round((t.x-50)/c.colGap);if(c.landDot(o),c.mode===n.GameMode.Network&&c.socket){var i={action:"click",column:o};c.socket.send(JSON.stringify(i))}}},this.beforeUnload=function(e){c.mode===n.GameMode.SamePC?c.saveGame():c.mode===n.GameMode.Network&&(e.preventDefault(),e.returnValue="")},this.timerCallback=function(){if(c.mode!==n.GameMode.Network||c.opponentConnected()){c.secondsRunning++;var e=Math.floor(c.secondsRunning/60),t=c.secondsRunning%60;c.timerSpan.innerText=e+":"+(t<10?"0":"")+t}if(c.timerSpan.classList.contains("hide"))a.Utils.clearTimeouts(c.timeouts);else{var o=setTimeout(c.timerCallback,1e3);c.timeouts.push(o),console.log(o)}},this.pageVisibilityChange=function(){if(c.mode!==n.GameMode.Network)if(document.hidden)a.Utils.clearTimeouts(c.timeouts);else{var e=setTimeout(c.timerCallback,1e3);c.timeouts.push(e)}},this.resizeCanvas=function(){c.canvas.height=window.innerHeight-100,c.canvas.width=window.innerWidth,c.canvas.width<1e3?c.circleRadius=20:c.circleRadius=30,c.canvas.height>c.canvas.width?(c.colGap=c.canvas.width/(e.columns+1),c.rowGap=c.canvas.height/(e.rows+1)):(c.colGap=c.canvas.width/(e.columns+1),c.rowGap=65),c.paintBoard()},this.socketMessage=function(e){var t=JSON.parse(e.data);if(!c.playerColor&&t.color){c.playerColor=t.color,c.setUpPlayerNames();var o={name:null};c.playerColor===i.Dot.Red?o.name=c.playerRed:c.playerColor===i.Dot.Green&&(o.name=c.playerGreen),c.socket.send(JSON.stringify(o))}t.opponentName&&(c.playerColor===i.Dot.Red?(c.playerGreen=t.opponentName,c.playerGreenSpan&&(c.playerGreenSpan.innerText=c.playerGreen)):c.playerColor===i.Dot.Green&&(c.playerRed=t.opponentName,c.playerRedSpan&&(c.playerRedSpan.innerText=c.playerRed))),!c.gameId&&t.gameId&&(c.gameId=t.gameId),t.message&&alert(t.message),t.win&&c.closeGameByWinning(),t.column&&"mousemove"===t.action&&c.moveDot(t.column),t.column&&"click"===t.action&&c.landDot(t.column)},this.socketError=function(e){alert("Problem connecting to server!")},this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.initBoard(),null!==o&&(this.exitBtn=document.getElementById(o)),null!==r&&(this.timerSpan=document.getElementById(r),this.secondsRunning=0),null!==s&&(this.playerRedSpan=document.getElementById(s)),null!==l&&(this.playerGreenSpan=document.getElementById(l))}return e.getInstance=function(t,o,n,i,r){return void 0===o&&(o=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),e.instance||(e.instance=new e(t,o,n,i,r)),e.instance},e.prototype.initBoard=function(){for(var t=0;t<e.columns;t++){this.board[t]=new Array(e.rows);for(var o=0;o<e.rows;o++)this.board[t][o]=i.Dot.Empty}},e.prototype.start=function(){this.defineSocket(),this.checkGameData(),this.resizeCanvas(),this.setUpPlayerNames(),this.setGameEvents(),this.setTimer()},e.prototype.checkGameData=function(){if(this.mode===n.GameMode.SamePC){var e=localStorage.getItem("board"),t=localStorage.getItem("nextTurn");e&&t&&(confirm("Do you want to continue playing the previous game? OK/Cancel")?this.restoreLastGame():localStorage.clear())}},e.prototype.setUpPlayerNames=function(){if(this.mode===n.GameMode.SamePC)localStorage.getItem("playerRed")&&localStorage.getItem("playerGreen")||(this.playerRed=prompt("Please enter name for Red Player!"),this.playerGreen=prompt("Please enter name for Green Player!"));else if(this.mode===n.GameMode.Network&&this.playerColor){var e=prompt("You are "+this.playerColor+". Please enter your name.");this.playerColor===i.Dot.Red?this.playerRed=e:this.playerColor===i.Dot.Green&&(this.playerGreen=e)}this.printPlayerNames()},e.prototype.printPlayerNames=function(){var e="Waiting to connect...";this.playerGreenSpan&&(this.mode!==n.GameMode.Network||this.playerGreen?this.playerGreenSpan.innerText=this.playerGreen:this.playerGreenSpan.innerText=e),this.playerRedSpan&&(this.mode!==n.GameMode.Network||this.playerRed?this.playerRedSpan.innerText=this.playerRed:this.playerRedSpan.innerText=e)},e.prototype.paintBoard=function(){var t=this.context.createLinearGradient(0,0,this.canvas.width,0);t.addColorStop(0,"blue"),t.addColorStop(1,"aqua"),this.context.fillStyle=t,this.context.fillRect(0,70,this.canvas.width,this.canvas.height);for(var o=e.columns-1;o>=0;o--)for(var n=e.rows-1;n>=0;n--)this.context.fillStyle=this.board[o][n],this.context.beginPath(),this.context.arc(50+o*this.colGap,150+n*this.rowGap,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill()},e.prototype.getCursorPosition=function(e){var t,o;return void 0!==e.pageX||void 0!==e.pageY?(t=e.pageX,o=e.pageY):(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),t-=this.canvas.offsetLeft,o-=this.canvas.offsetTop,new r.Position(t,o)},e.prototype.setGameEvents=function(){this.canvas.addEventListener("mousemove",this.canvasMousemove,!1),this.canvas.addEventListener("click",this.canvasClick,!1),window.addEventListener("beforeunload",this.beforeUnload),window.addEventListener("resize",this.resizeCanvas),document.addEventListener("visibilitychange",this.pageVisibilityChange)},e.prototype.switchTurn=function(){this.turn===i.Dot.Red?this.turn=i.Dot.Green:this.turn===i.Dot.Green&&(this.turn=i.Dot.Red)},e.prototype.moveDot=function(e){this.clearUpper(),this.context.fillStyle=this.turn,this.paintDotToDrop(e)},e.prototype.landDot=function(t){var o;if(this.board[t][0]===i.Dot.Empty){for(var n=e.rows-1;n>-1;n--)if(this.board[t][n]===i.Dot.Empty){this.board[t][n]=this.turn,o=n;break}if(this.context.fillStyle=this.turn,this.context.beginPath(),this.context.arc(50+t*this.colGap,150+n*this.rowGap,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill(),this.checkDotCount(t,o)>3){var r="";this.turn===i.Dot.Red?r=this.playerRed+" (Red)":this.turn===i.Dot.Green&&(r=this.playerGreen+" (Green)"),this.winDialog(r),this.closeGameByWinning()}else this.isBoardFull()?(alert(this.playerRed+" (Red) and "+this.playerGreen+" (Green) are tied!"),this.closeGameByWinning()):(this.switchTurn(),this.context.fillStyle=this.turn,this.paintDotToDrop(t))}},e.prototype.winDialog=function(e){var t=e+" wins!";this.timerSpan&&(t+="\nTime taken: "+this.timerSpan.innerText),this.mode===n.GameMode.Network&&(t+="\n",this.playerColor===this.turn?t+="You win!":t+="You lose!"),alert(t)},e.prototype.closeGameByWinning=function(){localStorage.clear(),this.cleanUpEvents(),this.stopTimer(),this.clearPlayerNames(),this.exitBtn&&this.exitBtn.classList.add("hide"),this.resetValues(),void 0!==this.onGameEnd&&null!==this.onGameEnd&&setTimeout(this.onGameEnd,3e3)},e.prototype.paintDotToDrop=function(e){this.context.beginPath(),this.context.arc(50+e*this.colGap,this.circleRadius,this.circleRadius,0,2*Math.PI),this.context.closePath(),this.context.fill()},e.prototype.clearUpper=function(){this.context.clearRect(0,0,this.canvas.width,70)},e.prototype.checkDotCount=function(t,o){for(var n=o,i=0;i<4&&n<e.rows&&this.board[t][n]===this.turn;)i++,n++;if(i<4){for(i=0,n=t;n<e.columns&&this.board[n][o]===this.turn;)i++,n++;for(n=t-1;n>-1&&this.board[n][o]===this.turn;)i++,n--;if(i<4){i=0;for(var r=o-1,a=t+1;i<4&&r>-1&&a<e.columns&&this.board[a][r]===this.turn;)i++,a++,r--;for(a=t,r=o;i<4&&r<e.rows&&a>-1&&this.board[a][r]===this.turn;)i++,a--,r++;if(i<4){for(i=0,r=o-1,a=t-1;i<4&&r>-1&&a>-1&&this.board[a][r]===this.turn;)i++,a--,r--;for(a=t,r=o;i<4&&r<e.rows&&a<e.columns&&this.board[a][r]===this.turn;)i++,a++,r++}}}return i},e.prototype.cleanUpEvents=function(){this.canvas.removeEventListener("mousemove",this.canvasMousemove,!1),this.canvas.removeEventListener("click",this.canvasClick,!1),window.removeEventListener("beforeunload",this.beforeUnload),window.removeEventListener("resize",this.resizeCanvas),document.removeEventListener("changevisibility",this.pageVisibilityChange)},e.prototype.saveGame=function(){localStorage.setItem("nextTurn",this.turn.toString()),localStorage.setItem("board",JSON.stringify(this.board)),localStorage.setItem("playerRed",this.playerRed),localStorage.setItem("playerGreen",this.playerGreen),localStorage.setItem("secondsRunning",this.secondsRunning.toString())},e.prototype.restoreLastGame=function(){var e=localStorage.getItem("nextTurn");e===i.Dot.Red?this.turn=i.Dot.Red:e===i.Dot.Green&&(this.turn=i.Dot.Green),this.playerRed=localStorage.getItem("playerRed"),this.playerGreen=localStorage.getItem("playerGreen"),this.board=JSON.parse(localStorage.getItem("board")),this.secondsRunning=parseInt(localStorage.getItem("secondsRunning"))},e.prototype.exit=function(){(this.mode!==n.GameMode.Network||confirm("Network game in progress. Are you sure you want to quit?"))&&(this.cleanUpEvents(),this.mode===n.GameMode.SamePC?this.saveGame():this.mode===n.GameMode.Network&&this.socket&&(this.socket.close(),this.socket=null),this.onGameEnd(),this.stopTimer(),this.clearPlayerNames(),this.resetValues())},e.prototype.setTimer=function(){this.timerSpan&&(this.timerSpan.classList.remove("hide"),this.timerCallback())},e.prototype.stopTimer=function(){this.timeouts.length>0&&(a.Utils.clearTimeouts(this.timeouts),this.timerSpan.innerText="",this.timerSpan.classList.add("hide"))},e.prototype.clearPlayerNames=function(){this.playerGreenSpan&&(this.playerGreenSpan.innerText=""),this.playerRedSpan&&(this.playerRedSpan.innerText="")},e.prototype.defineSocket=function(){if(this.mode===n.GameMode.Network){var e=void 0;a.Utils.isLocal()&&(e="ws://localhost:443/"),this.socket=new WebSocket(e),this.socket.onmessage=this.socketMessage,this.socket.onerror=this.socketError}},e.prototype.opponentConnected=function(){return this.mode===n.GameMode.Network&&!!this.playerRed&&!!this.playerGreen},e.prototype.isBoardFull=function(){for(var t=!0,o=0;o<e.columns;o++)if(this.board[o][0]===i.Dot.Empty){t=!1;break}return t},e.prototype.resetValues=function(){this.secondsRunning=0,this.turn=i.Dot.Red,this.initBoard(),this.playerRed=null,this.playerGreen=null},e.columns=9,e.rows=8,e}();t.Game=s},42:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Position=void 0;t.Position=function(e,t){this.x=e,this.y=t}},721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var o=function(){function e(){}return e.isLocal=function(){return"file:"===location.protocol||"localhost"===location.hostname},e.clearTimeouts=function(e){for(var t=0;t<e.length;t++)clearTimeout(e[t])},e}();t.Utils=o}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}(()=>{var e,t=o(664),n=o(607),i=document.getElementById("menu"),r=document.getElementById("samePC"),a=document.getElementById("sockets"),s=document.getElementById("credits"),l=document.getElementById("exitBtn"),c=document.getElementById("board");function d(o){(e=t.Game.getInstance("board","exitBtn","timer","playerRed","playerGreen")).mode=o,e.onGameEnd=function(){i.classList.remove("hide"),c.classList.add("hide"),l.classList.add("hide")},e.start(),i.classList.add("hide"),c.classList.remove("hide"),l.classList.remove("hide")}r.addEventListener("click",(function(){d(n.GameMode.SamePC)}),!1),a.addEventListener("click",(function(){d(n.GameMode.Network)}),!1),s.addEventListener("click",(function(){open("contributors.html")}),!1),l.addEventListener("click",(function(){e.exit()}),!1)})()})();
//# sourceMappingURL=bundle.js.map